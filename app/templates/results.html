<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ t["result.title"] }}</title>
    <link rel="stylesheet" href="/static/style.css" />
    <!-- Google Analytics (GA4) - production only -->
    <script>
    if(location.hostname==='gc.ranran.tw'){
      var s=document.createElement('script');s.async=true;s.src='https://www.googletagmanager.com/gtag/js?id=G-VHQQ1MP511';document.head.appendChild(s);
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-VHQQ1MP511');
    }
    </script>
  </head>
  <body>
    <nav class="result-nav">
      <a href="/" class="nav-brand">GEO Checker</a>
      <a href="/" class="nav-back">‚Üê {{ t["nav.new_check"] }}</a>
    </nav>
    <div class="container">
      <div class="card">
        <h1 class="title">{{ t["result.title"] }}</h1>
        {% if result %}
          {% set geo = result.geo if result.geo is defined else {} %}
          {% set geo_score = geo.geo_score if geo and geo.geo_score is defined else {} %}
          {% set summary = geo.summary if geo and geo.summary is defined else {} %}
          {% set crawler = geo.ai_crawler_access if geo and geo.ai_crawler_access is defined else {} %}
          {% set usage = geo.ai_usage_interpretation if geo and geo.ai_usage_interpretation is defined else {} %}
          {% set hints = geo.interpretation_rule_hints if geo and geo.interpretation_rule_hints is defined else {} %}
          {% set blockers = geo.last_mile_blockers if geo and geo.last_mile_blockers is defined else [] %}
          {% set fixes = geo.structural_fixes if geo and geo.structural_fixes is defined else [] %}
          {% set readability = result.readability if result.readability is defined else {} %}
          {% set schema_org = result.schema_org if result.schema_org is defined else {} %}
          {% set quotables = result.quotable_sentences if result.quotable_sentences is defined else [] %}

          <!-- Draft Mode Banner -->
          {% if geo and geo.draft_mode is defined and geo.draft_mode %}
          <div class="draft-mode-banner">
            Ghost Draft Mode ‚Äî Content Only
          </div>
          {% endif %}

          <!-- Summary Dashboard -->
          {% if geo_score %}
          <div class="dashboard">
            <div class="score-circle grade-{{ geo_score.grade|lower }}">
              <div class="score-value" data-target="{{ geo_score.total }}">{{ geo_score.total }}</div>
              <div class="score-label">GEO Score</div>
            </div>
            <div class="dashboard-info">
              <div class="grade-badge grade-{{ geo_score.grade|lower }}">{{ geo_score.grade }}</div>
              <div class="grade-label">{{ t["grade." ~ geo_score.grade|lower] if t["grade." ~ geo_score.grade|lower] is defined else geo_score.grade_label }}</div>
              <div class="summary-text">{{ t["summary." ~ summary.summary_key] if summary.summary_key and t["summary." ~ summary.summary_key] is defined else "" }}</div>
            </div>
          </div>

          <!-- Score Breakdown -->
          <div class="section">
            <div class="breakdown-grid">
              <div class="breakdown-item">
                <div class="breakdown-label">
                  {{ t["breakdown.accessibility"] }}
                  <span class="info-tip" data-tip="{{ t['breakdown.accessibility.tip'] }}">?</span>
                </div>
                <div class="breakdown-bar">
                  <div class="breakdown-fill" data-percentage="{{ geo_score.breakdown.accessibility.percentage }}" style="width: 0%"></div>
                </div>
                <div class="breakdown-value">{{ geo_score.breakdown.accessibility.score }}/{{ geo_score.breakdown.accessibility.max }}</div>
              </div>
              <div class="breakdown-item">
                <div class="breakdown-label">
                  {{ t["breakdown.structure"] }}
                  <span class="info-tip" data-tip="{{ t['breakdown.structure.tip'] }}">?</span>
                </div>
                <div class="breakdown-bar">
                  <div class="breakdown-fill" data-percentage="{{ geo_score.breakdown.structure.percentage }}" style="width: 0%"></div>
                </div>
                <div class="breakdown-value">{{ geo_score.breakdown.structure.score }}/{{ geo_score.breakdown.structure.max }}</div>
              </div>
              <div class="breakdown-item">
                <div class="breakdown-label">
                  {{ t["breakdown.quality"] }}
                  <span class="info-tip" data-tip="{{ t['breakdown.quality.tip'] }}">?</span>
                </div>
                <div class="breakdown-bar">
                  <div class="breakdown-fill" data-percentage="{{ geo_score.breakdown.quality.percentage }}" style="width: 0%"></div>
                </div>
                <div class="breakdown-value">{{ geo_score.breakdown.quality.score }}/{{ geo_score.breakdown.quality.max }}</div>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Priority Fixes -->
          {% if summary and summary.issues %}
          <div class="section">
            <h2>{{ t["result.section.priority"] }}</h2>
            {% if summary.issues.critical|length > 0 %}
            <div class="issue-group issue-critical">
              <div class="issue-header">
                <span class="issue-icon">&#10060;</span>
                <span class="issue-title">{{ t["issues.critical"] }}</span>
              </div>
              <ul class="issue-list">
                {% for issue in summary.issues.critical %}
                <li class="issue-item">
                  <span class="issue-text">{{ t["issue." ~ issue] if t["issue." ~ issue] is defined else issue }}</span>
                  {% if t["guide." ~ issue ~ ".desc"] is defined %}
                  <details class="issue-guide">
                    <summary>{{ t["guide.how_to_fix"] }}</summary>
                    <div class="guide-content">
                      <p>{{ t["guide." ~ issue ~ ".desc"] }}</p>
                      {% if t["guide." ~ issue ~ ".solution"] is defined %}
                      <p class="guide-solution">{{ t["guide." ~ issue ~ ".solution"] }}</p>
                      {% endif %}
                      {% if t["guide." ~ issue ~ ".code"] is defined %}
                      <pre class="guide-code">{{ t["guide." ~ issue ~ ".code"] }}</pre>
                      {% endif %}
                      {% if t["guide." ~ issue ~ ".tips"] is defined %}
                      <p class="guide-tips">{{ t["guide." ~ issue ~ ".tips"] }}</p>
                      {% endif %}
                    </div>
                  </details>
                  {% endif %}
                </li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
            {% if summary.issues.warning|length > 0 %}
            <div class="issue-group issue-warning">
              <div class="issue-header">
                <span class="issue-icon">&#9888;</span>
                <span class="issue-title">{{ t["issues.warning"] }}</span>
              </div>
              <ul class="issue-list">
                {% for issue in summary.issues.warning %}
                <li class="issue-item">
                  <span class="issue-text">{{ t["issue." ~ issue] if t["issue." ~ issue] is defined else issue }}</span>
                  {% if t["guide." ~ issue ~ ".desc"] is defined %}
                  <details class="issue-guide">
                    <summary>{{ t["guide.how_to_fix"] }}</summary>
                    <div class="guide-content">
                      <p>{{ t["guide." ~ issue ~ ".desc"] }}</p>
                      {% if t["guide." ~ issue ~ ".solution"] is defined %}
                      <p class="guide-solution">{{ t["guide." ~ issue ~ ".solution"] }}</p>
                      {% endif %}
                      {% if t["guide." ~ issue ~ ".code"] is defined %}
                      <pre class="guide-code">{{ t["guide." ~ issue ~ ".code"] }}</pre>
                      {% endif %}
                      {% if t["guide." ~ issue ~ ".tips"] is defined %}
                      <p class="guide-tips">{{ t["guide." ~ issue ~ ".tips"] }}</p>
                      {% endif %}
                    </div>
                  </details>
                  {% endif %}
                </li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
            {% if summary.issues.good|length > 0 %}
            <div class="issue-group issue-good">
              <div class="issue-header">
                <span class="issue-icon">&#10004;</span>
                <span class="issue-title">{{ t["issues.good"] }}</span>
              </div>
              <ul class="issue-list">
                {% for issue in summary.issues.good %}
                <li>{{ t["issue." ~ issue] if t["issue." ~ issue] is defined else issue }}</li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}
          </div>
          {% endif %}

          <!-- Page Metadata -->
          <div class="section">
            <h2>{{ t["result.section.metadata"] }}</h2>
            <div class="meta-grid">
              <div class="meta-label">{{ t["history.table.url"] }}</div>
              <div class="url-text">{{ result.url }}</div>
              <div class="meta-label">{{ t["result.meta.title"] }}</div>
              <div>{{ result.meta.title }}</div>
              <div class="meta-label">{{ t["result.meta.description"] }}</div>
              <div>{{ result.meta.description }}</div>
              <div class="meta-label">{{ t["result.meta.canonical"] }}</div>
              <div>{{ result.meta.canonical }}</div>
            </div>
          </div>

          <!-- AI Crawler Access (hidden in draft mode) -->
          {% if not (geo and geo.draft_mode is defined and geo.draft_mode) %}
          <div class="section">
            <h2>
              {{ t["result.section.crawler"] }}
              <span class="info-tip" data-tip="{{ t['tooltip.crawler_access'] }}">?</span>
            </h2>
            {% if crawler %}
              <p class="section-intro">{{ t["crawler.intro"] }}</p>
              <div class="crawler-grid">
                <div class="crawler-item">
                  <div class="crawler-info">
                    <div class="crawler-name">{{ t["crawler.agent.gptbot"] }}</div>
                    <div class="crawler-company">{{ t["crawler.company.gptbot"] }}</div>
                  </div>
                  <div class="crawler-status status-{{ crawler.gptbot }}">
                    {% if crawler.gptbot == "allow" %}
                      <span class="status-icon">&#10004;</span>{{ t["crawler.status.allow"] }}
                    {% elif crawler.gptbot == "disallow" %}
                      <span class="status-icon">&#10060;</span>{{ t["crawler.status.disallow"] }}
                    {% else %}
                      <span class="status-icon">&#8212;</span>{{ t["crawler.status.unspecified"] }}
                    {% endif %}
                  </div>
                </div>
                <div class="crawler-item">
                  <div class="crawler-info">
                    <div class="crawler-name">{{ t["crawler.agent.claudebot"] }}</div>
                    <div class="crawler-company">{{ t["crawler.company.claudebot"] }}</div>
                  </div>
                  <div class="crawler-status status-{{ crawler.claudebot }}">
                    {% if crawler.claudebot == "allow" %}
                      <span class="status-icon">&#10004;</span>{{ t["crawler.status.allow"] }}
                    {% elif crawler.claudebot == "disallow" %}
                      <span class="status-icon">&#10060;</span>{{ t["crawler.status.disallow"] }}
                    {% else %}
                      <span class="status-icon">&#8212;</span>{{ t["crawler.status.unspecified"] }}
                    {% endif %}
                  </div>
                </div>
                <div class="crawler-item">
                  <div class="crawler-info">
                    <div class="crawler-name">{{ t["crawler.agent.perplexitybot"] }}</div>
                    <div class="crawler-company">{{ t["crawler.company.perplexitybot"] }}</div>
                  </div>
                  <div class="crawler-status status-{{ crawler.perplexitybot }}">
                    {% if crawler.perplexitybot == "allow" %}
                      <span class="status-icon">&#10004;</span>{{ t["crawler.status.allow"] }}
                    {% elif crawler.perplexitybot == "disallow" %}
                      <span class="status-icon">&#10060;</span>{{ t["crawler.status.disallow"] }}
                    {% else %}
                      <span class="status-icon">&#8212;</span>{{ t["crawler.status.unspecified"] }}
                    {% endif %}
                  </div>
                </div>
                <div class="crawler-item">
                  <div class="crawler-info">
                    <div class="crawler-name">{{ t["crawler.agent.google_extended"] }}</div>
                    <div class="crawler-company">{{ t["crawler.company.google_extended"] }}</div>
                  </div>
                  <div class="crawler-status status-{{ crawler.google_extended }}">
                    {% if crawler.google_extended == "allow" %}
                      <span class="status-icon">&#10004;</span>{{ t["crawler.status.allow"] }}
                    {% elif crawler.google_extended == "disallow" %}
                      <span class="status-icon">&#10060;</span>{{ t["crawler.status.disallow"] }}
                    {% else %}
                      <span class="status-icon">&#8212;</span>{{ t["crawler.status.unspecified"] }}
                    {% endif %}
                  </div>
                </div>
              </div>
              <div class="meta-grid" style="margin-top: 16px;">
                <div class="meta-label">{{ t["crawler.robots_txt"] }}</div>
                <div>
                  {% if crawler.robots_txt_found %}
                    {{ t["crawler.robots_txt.found"] }}
                  {% else %}
                    {{ t["crawler.robots_txt.missing"] }}
                  {% endif %}
                </div>
                <div class="meta-label">{{ t["crawler.meta_robots"] }}</div>
                <div>{{ crawler.meta_robots.content or t["crawler.meta_robots.none"] }}</div>
                <div class="meta-label">{{ t["crawler.x_robots_tag"] }}</div>
                <div>{{ crawler.x_robots_tag.value or t["crawler.x_robots_tag.none"] }}</div>
              </div>
              {% if crawler.notes %}
              <p class="subtitle" style="margin-top: 12px;">{{ crawler.notes }}</p>
              {% endif %}
            {% else %}
              <p>{{ t["crawler.unavailable"] }}</p>
            {% endif %}
          </div>
          {% endif %}

          <!-- Schema.org Structured Data -->
          {% if schema_org and schema_org.types|length > 0 %}
          <div class="section">
            <h2>
              {{ t["result.section.schema"] }}
              <span class="info-tip" data-tip="{{ t['tooltip.schema_org'] }}">?</span>
            </h2>
            <div class="schema-grid">
              {% for type in schema_org.types %}
              <div class="schema-badge">{{ type }}</div>
              {% endfor %}
            </div>
            {% if schema_org.has_faq %}
            <div class="schema-feature">
              <span class="feature-icon">&#10004;</span>
              {{ t["schema.has_faq"] }}
            </div>
            {% endif %}
            {% if schema_org.has_howto %}
            <div class="schema-feature">
              <span class="feature-icon">&#10004;</span>
              {{ t["schema.has_howto"] }}
            </div>
            {% endif %}
            {% if schema_org.has_article %}
            <div class="schema-feature">
              <span class="feature-icon">&#10004;</span>
              {{ t["schema.has_article"] }}
            </div>
            {% endif %}
          </div>
          {% endif %}

          <!-- Readability Metrics -->
          {% if readability and readability.available %}
          <div class="section">
            <h2>
              {{ t["result.section.readability"] }}
              <span class="info-tip" data-tip="{{ t['tooltip.readability'] }}">?</span>
            </h2>
            <div class="readability-grid">
              <div class="readability-item">
                <div class="readability-value">{{ readability.flesch_reading_ease|default(0)|round(1) }}</div>
                <div class="readability-label">{{ t["readability.flesch.label"] }}</div>
                <div class="readability-note">
                  {% if readability.flesch_reading_ease and readability.flesch_reading_ease >= 60 %}{{ t["readability.easy"] }}
                  {% elif readability.flesch_reading_ease and readability.flesch_reading_ease >= 30 %}{{ t["readability.moderate"] }}
                  {% else %}{{ t["readability.difficult"] }}{% endif %}
                </div>
                <div class="readability-desc">{{ t["readability.flesch.note"] }}</div>
              </div>
              <div class="readability-item">
                <div class="readability-value">{{ readability.flesch_kincaid_grade|default(0)|round(1) }}</div>
                <div class="readability-label">{{ t["readability.grade.label"] }}</div>
                <div class="readability-note">{{ t["readability.grade_note"] }}</div>
                <div class="readability-desc">{{ t["readability.grade.note"] }}</div>
              </div>
              <div class="readability-item">
                <div class="readability-value">{{ readability.reading_time_minutes|default(0)|round(1) }} {{ t["readability.minutes"] }}</div>
                <div class="readability-label">{{ t["readability.time.label"] }}</div>
                <div class="readability-desc">{{ t["readability.time.note"] }}</div>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Quotable Sentences -->
          {% if quotables|length > 0 %}
          <div class="section">
            <h2>
              {{ t["result.section.quotable"] }}
              <span class="info-tip" data-tip="{{ t['tooltip.quotable'] }}">?</span>
            </h2>
            <div class="quotable-list">
              {% for q in quotables[:5] %}
              <div class="quotable-item">
                <div class="quotable-type">{{ t["quotable." ~ q.type] if t["quotable." ~ q.type] is defined else q.type }}</div>
                <div class="quotable-text">"{{ q.text }}"</div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Content Health (Simplified AI Usage Profile) -->
          <div class="section">
            <h2>
              {{ t["result.section.content_health"] }}
              <span class="info-tip" data-tip="{{ t['tooltip.content_health'] }}">?</span>
            </h2>
            <div class="health-grid">
              <div class="health-item">
                <div class="health-label">{{ t["health.content_type"] }}</div>
                <div class="health-value">
                  {% if usage.type == "Reference-leaning" %}{{ t["usage.type.reference"] }}
                  {% elif usage.type == "Mixed Usage" %}{{ t["usage.type.mixed"] }}
                  {% else %}{{ t["usage.type.conceptual"] }}{% endif %}
                </div>
              </div>
              <div class="health-item">
                <div class="health-label">{{ t["health.readable_content"] }}</div>
                <div class="health-value">{{ result.content_surface_size.score }} {{ t["health.blocks"] }}</div>
              </div>
            </div>
            <details class="section-details">
              <summary>{{ t["result.show_details"] }}</summary>
              <div class="details-content">
                <div class="surface-grid">
                  <div class="surface-item">{{ t["surface.heading"] }}: {{ result.content_surface_size.components.heading_blocks }}</div>
                  <div class="surface-item">{{ t["surface.paragraph"] }}: {{ result.content_surface_size.components.paragraph_blocks }}</div>
                  <div class="surface-item">{{ t["surface.list"] }}: {{ result.content_surface_size.components.list_blocks }}</div>
                  <div class="surface-item">{{ t["surface.table"] }}: {{ result.content_surface_size.components.table_blocks }}</div>
                </div>
              </div>
            </details>
          </div>

          <!-- Extended Metrics (Phase 1-3) -->
          {% set ext = geo.extended_metrics if geo and geo.extended_metrics is defined else {} %}
          {% if ext %}
          <div class="section">
            <h2>
              {{ t["result.section.extended"] }}
              <span class="info-tip" data-tip="{{ t['tooltip.extended_metrics'] }}">?</span>
            </h2>
            <div class="extended-grid">
              <!-- Citation Potential -->
              {% set citation = ext.citation_potential if ext.citation_potential is defined else {} %}
              <div class="extended-item extended-highlight">
                <div class="extended-label">{{ t["extended.citation_potential"] }}</div>
                <div class="extended-value citation-{{ citation.level|default('minimal') }}">
                  {{ t["extended.citation." ~ citation.level] if citation.level and t["extended.citation." ~ citation.level] is defined else citation.level|default('‚Äî') }}
                </div>
                <div class="extended-score">{{ citation.score|default(0) }}/{{ citation.max_score|default(11) }}</div>
              </div>

              <!-- Entity Count -->
              <div class="extended-item">
                <div class="extended-label">{{ t["extended.entity_count"] }}</div>
                <div class="extended-value">{{ ext.entity_count|default(0) }}</div>
              </div>

              <!-- Q&A Structure -->
              {% set qa = ext.qa_structure if ext.qa_structure is defined else {} %}
              <div class="extended-item">
                <div class="extended-label">{{ t["extended.qa_structure"] }}</div>
                <div class="extended-value">
                  {% if qa.has_qa_structure %}
                    <span class="status-icon">&#10004;</span> {{ t["extended.qa.detected"] }}
                  {% else %}
                    <span class="status-muted">‚Äî</span> {{ t["extended.qa.none"] }}
                  {% endif %}
                </div>
              </div>

              <!-- Content Depth -->
              {% set depth = ext.content_depth if ext.content_depth is defined else {} %}
              <div class="extended-item">
                <div class="extended-label">{{ t["extended.content_depth"] }}</div>
                <div class="extended-value">
                  {{ depth.word_count|default(0) }} {{ t["extended.words"] }}
                  {% if depth.has_deep_hierarchy %}<span class="depth-badge">{{ t["extended.deep_hierarchy"] }}</span>{% endif %}
                </div>
              </div>

              <!-- Link Quality -->
              {% set links = ext.link_quality if ext.link_quality is defined else {} %}
              <div class="extended-item">
                <div class="extended-label">{{ t["extended.link_quality"] }}</div>
                <div class="extended-value">
                  {{ links.total_links|default(0) }} {{ t["extended.links"] }}
                  ({{ links.descriptive_anchors|default(0) }} {{ t["extended.descriptive"] }})
                </div>
              </div>

              <!-- First Paragraph -->
              {% set first = ext.first_paragraph if ext.first_paragraph is defined else {} %}
              <div class="extended-item">
                <div class="extended-label">{{ t["extended.first_paragraph"] }}</div>
                <div class="extended-value">
                  {% if first.has_strong_opening %}
                    <span class="status-icon">&#10004;</span> {{ t["extended.opening.strong"] }}
                  {% else %}
                    <span class="status-muted">‚Äî</span> {{ t["extended.opening.weak"] }}
                  {% endif %}
                </div>
              </div>

              <!-- Pronoun Clarity -->
              {% set pronouns = ext.pronoun_clarity if ext.pronoun_clarity is defined else {} %}
              <div class="extended-item">
                <div class="extended-label">{{ t["extended.pronoun_clarity"] }}</div>
                <div class="extended-value">
                  {% if pronouns.score is defined and pronouns.score >= 2 %}
                    <span class="status-icon">&#10004;</span> {{ t["extended.pronouns.clear"] }}
                  {% elif pronouns.paragraphs_starting_with_pronoun is defined and pronouns.paragraphs_starting_with_pronoun >= 3 %}
                    <span class="status-warn">&#9888;</span> {{ t["extended.pronouns.unclear"] }}
                  {% else %}
                    <span class="status-muted">‚Äî</span> {{ t["extended.pronouns.ok"] }}
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Optimization Suggestions (Combined Blockers + Fixes) -->
          {% if (blockers and blockers|length > 0) or (fixes and fixes|length > 0) %}
          <div class="section">
            <h2>
              {{ t["result.section.optimization"] }}
              <span class="info-tip" data-tip="{{ t['tooltip.optimization'] }}">?</span>
            </h2>
            {% if fixes and fixes|length > 0 %}
              <div class="optimization-list">
                {% for fix in fixes %}
                <div class="optimization-item">
                  <div class="optimization-action">{{ t["structural_fixes." ~ fix.action] }}</div>
                  <div class="optimization-reason">
                    {{ t["optimization.helps_with"] }}:
                    {% for address in fix.addresses_blockers %}
                      <span class="optimization-tag">{{ t["blockers." ~ address] }}</span>
                    {% endfor %}
                  </div>
                </div>
                {% endfor %}
              </div>
            {% else %}
              <p class="success-text">{{ t["optimization.none_needed"] }}</p>
            {% endif %}
          </div>
          {% endif %}

          <!-- Representative Excerpts -->
          <div class="section">
            <h2>{{ t["input.section.title"] }}</h2>
            <p class="subtitle">
              {{ t["input.section.note.line1"] }}<br />
              {{ t["input.section.note.line2"] }}
            </p>
            {% if excerpts and excerpts|length > 0 %}
              <div class="example">
                {% for excerpt in excerpts %}
                  <div>{{ excerpt }}</div>
                {% endfor %}
              </div>
            {% else %}
              <div class="example">{{ t["input.section.empty"] }}</div>
            {% endif %}
          </div>

          <!-- Collapsible Sections -->
          <div class="section">
            <details>
              <summary>{{ t["result.section.other"] }}</summary>
              <div class="meta-grid" style="margin-top: 12px;">
                <div class="meta-label">{{ t["surface.paragraph"] }}</div>
                <div>{{ result.stats.paragraph_count }}</div>
                <div class="meta-label">{{ t["surface.heading"] }}</div>
                <div>{{ result.stats.heading_count }}</div>
                <div class="meta-label">{{ t["result.links.internal"] }}</div>
                <div>{{ result.stats.internal_links }}</div>
                <div class="meta-label">{{ t["result.links.external"] }}</div>
                <div>{{ result.stats.external_links }}</div>
              </div>
            </details>
          </div>

          <div class="section">
            <details>
              <summary>{{ t["result.section.technical"] }}</summary>
              <div class="meta-grid" style="margin-top: 12px;">
                <div class="meta-label">{{ t["result.word_count.label"] }}</div>
                <div>{{ result.stats.word_count }}</div>
                <div class="meta-label"></div>
                <div>{{ t["result.word_count.note"] }}</div>
              </div>
              <div class="section">
                <div class="subtitle">
                  {{ t["input.download.note.line1"] }}<br />
                  {{ t["input.download.note.line2"] }}
                </div>
                <a class="muted-link" href="/results/{{ result_id }}/input.json">
                  {{ t["input.download.button"] }}
                </a>
              </div>
            </details>
          </div>
        {% else %}
          <p>{{ t["result.not_found"] }}: {{ result_id }}</p>
        {% endif %}
        <!-- Level 3: AI Brand Visibility - Vision Preview -->
          <div class="section level3-section">
            <h2>
              {{ t["level3.title"] }}
              <span class="badge-coming">{{ t["level3.badge"] }}</span>
            </h2>
            <p class="section-intro">{{ t["level3.intro"] }}</p>

            <div class="vision-preview">
              <div class="vision-feature">
                <div class="vision-icon">üîç</div>
                <div class="vision-text">
                  <strong>{{ t["level3.feature1.title"] }}</strong>
                  <p>{{ t["level3.feature1.desc"] }}</p>
                </div>
              </div>
              <div class="vision-feature">
                <div class="vision-icon">üìä</div>
                <div class="vision-text">
                  <strong>{{ t["level3.feature2.title"] }}</strong>
                  <p>{{ t["level3.feature2.desc"] }}</p>
                </div>
              </div>
              <div class="vision-feature">
                <div class="vision-icon">üîë</div>
                <div class="vision-text">
                  <strong>{{ t["level3.feature3.title"] }}</strong>
                  <p>{{ t["level3.feature3.desc"] }}</p>
                </div>
              </div>
            </div>

            <div class="vision-cta">
              <p>{{ t["level3.cta"] }}</p>
            </div>
          </div>

        <div class="section">
          <a class="muted-link" href="/">{{ t["nav.back"] }}</a>
        </div>
      </div>
    </div>

    <script>
      // Save this result to localStorage history
      (function() {
        const resultId = "{{ result_id }}";
        const url = "{{ result.url if result else '' }}";
        const score = {{ result.content_surface_size.score if result and result.content_surface_size else 'null' }};
        const createdAt = "{{ result.created_at if result else '' }}";

        if (resultId && url) {
          let history = JSON.parse(localStorage.getItem("geo_history") || "[]");

          // Remove if already exists
          history = history.filter(item => item.id !== resultId);

          // Add to front
          history.unshift({
            id: resultId,
            url: url,
            score: score,
            created_at: createdAt
          });

          // Keep only last 50
          history = history.slice(0, 50);

          localStorage.setItem("geo_history", JSON.stringify(history));
        }
      })();
    </script>
    <script src="/static/js/score-animation.js"></script>
  </body>
</html>
